# NOTE: (mibui 2024-04-27) Swap must be disabled for kubelet to work correctly
- name: Disable swap
  hosts: allhosts
  become: true
  tasks:
      - name: Disable swap for current session
        command: swapoff -a
        become: true

      - name: Disable swap permanently, persist reboots
        replace:
            path: /etc/fstab
            regexp: '^(\s*)([^#\n]+\s+)(\w+\s+)swap(\s+.*)$'
            replace: '#\1\2\3swap\4'
            backup: yes
